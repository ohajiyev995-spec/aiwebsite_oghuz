import{ROSTER as e}from"./roster.js";const t={openPopoverId:null,modalOpen:!1,activeTrapElements:[]};function n(e,n){e.setAttribute("aria-hidden","true"),function(){const e=document.getElementById("popover-modal");e&&e.removeEventListener("keydown",o);t.activeTrapElements=[]}(),t.modalOpen=!1,n?.focus()}function o(e){if("Tab"!==e.key)return;const[n,o]=t.activeTrapElements;n&&o&&(e.shiftKey&&document.activeElement===n?(e.preventDefault(),o.focus()):e.shiftKey||document.activeElement!==o||(e.preventDefault(),n.focus()))}function i(e){const t=["th","st","nd","rd"],n=Math.abs(e),o=n%100;if(o>=11&&o<=13)return`${n}th`;return`${n}${t[n%10]||t[0]}`}function r(e){const n=document.getElementById(`popover-${e}`);n&&n.setAttribute("aria-hidden","true"),t.openPopoverId===e&&(t.openPopoverId=null)}document.addEventListener("DOMContentLoaded",()=>{!function(){const e=document.body.dataset.page,t="fighter"===e?"divisions":e;document.querySelectorAll(".primary-nav [data-nav]").forEach(e=>e.classList.toggle("active",e.dataset.nav===t))}(),function(){const e=document.querySelector(".nav-toggle"),t=document.querySelector(".primary-nav");if(!e||!t)return;e.addEventListener("click",()=>{const n="true"===e.getAttribute("aria-expanded");e.setAttribute("aria-expanded",String(!n)),t.dataset.open=n?"false":"true",n?e.focus():t.querySelector("a")?.focus()}),document.addEventListener("keydown",n=>{"Escape"===n.key&&"true"===t.dataset.open&&e.click()})}(),function(){const t=document.getElementById("featured-strip");if(!t)return;const n=e.divisions.flatMap(e=>e.fighters.map(t=>({fighter:t,division:e}))),o=n[Math.floor(Math.random()*n.length)];if(!o)return;const{fighter:r,division:a}=o,s=t.querySelector(".featured-avatar"),d=t.querySelector(".featured-meta"),c=t.querySelector("a.button");s&&(s.src=r.img,s.alt=`${r.name} portrait`,s.loading="lazy");d&&(d.innerHTML=`\n      <strong>${r.name}</strong>\n      <span>${i(r.rank)} in ${a.name} 路 Record ${r.record}</span>\n    `);c&&(c.href=`fighters/${r.slug}.html`,c.textContent=`View ${r.name}`)}(),function(){const a=document.getElementById("quick-browse-list");if(!a)return;const s=document.createDocumentFragment();e.divisions.forEach(a=>{const d=document.createElement("div");d.className="quick-browse__item";const c=document.createElement("button");c.type="button",c.className="quick-browse__button",c.setAttribute("aria-haspopup","dialog"),c.dataset.divisionId=a.id,c.innerHTML=`\n      <strong>${a.name}</strong><br />\n      <span style="color: var(--color-muted); font-size: 0.85rem;">${a.weight}</span>\n    `;const u=function(e){const t=document.createElement("div");t.className="quick-browse__popover surface",t.setAttribute("role","dialog"),t.setAttribute("aria-label",`${e.name} fighters`);const n=document.createElement("div");return n.className="mini-roster",e.fighters.forEach(e=>{const t=document.createElement("div");t.className="mini-roster__fighter",t.innerHTML=`\n      <img src="${e.img}" alt="${e.name} portrait" loading="lazy" />\n      <div>\n        <strong>${e.name}</strong>\n        <span class="rank">${i(e.rank)} 路 ${e.record}</span>\n      </div>\n      <a class="button button-outline" href="fighters/${e.slug}.html">Open page</a>\n    `,n.append(t)}),t.append(n),t}(a);u.id=`popover-${a.id}`,u.setAttribute("aria-hidden","true"),c.addEventListener("click",()=>{!function(i,a,s){if(window.matchMedia("(max-width: 740px)").matches)return void function(i,r,a){const s=document.getElementById("popover-modal");if(!s)return;const d=s.querySelector("#popover-title"),c=s.querySelector("#popover-content");c.innerHTML="",c.append(r.cloneNode(!0));const u=e.divisions.find(e=>e.id===i);u&&d&&(d.textContent=u.name);s.setAttribute("aria-hidden","false"),t.modalOpen=!0,function(e){const n=["a[href]","button","input","select","textarea","[tabindex]:not([tabindex='-1'])"],i=Array.from(e.querySelectorAll(n.join(","))).filter(e=>!e.hasAttribute("disabled"));if(0===i.length)return;t.activeTrapElements=[i[0],i[i.length-1]],i[0].focus(),e.addEventListener("keydown",o)}(s);s.querySelectorAll("[data-action='close-popover']").forEach(e=>{e.addEventListener("click",()=>{n(s,a)},{once:!0})}),document.addEventListener("keydown",e=>{"Escape"===e.key&&n(s,a)},{once:!0})}(i,a,s);if(t.openPopoverId===i)return r(i),void s.focus();t.openPopoverId&&r(t.openPopoverId);a.setAttribute("aria-hidden","false"),t.openPopoverId=i}(a.id,u,c)}),d.append(c,u),s.append(d)}),a.append(s)}(),document.addEventListener("click",e=>{if(!t.openPopoverId)return;const n=document.getElementById(`popover-${t.openPopoverId}`),o=document.querySelector(`[data-division-id='${t.openPopoverId}']`);n&&o&&!n.contains(e.target)&&e.target!==o&&(r(t.openPopoverId),o?.focus())}),document.addEventListener("keydown",e=>{if("Escape"===e.key&&t.openPopoverId){const e=document.querySelector(`[data-division-id='${t.openPopoverId}']`);r(t.openPopoverId),e?.focus()}}),"divisions"===document.body.dataset.page&&function(){const t=document.getElementById("division-filters"),n=document.getElementById("division-grid"),o=document.getElementById("division-count"),r=document.getElementById("empty-state"),a=document.querySelector("[data-action='reset-filters']"),s=()=>{const a=new FormData(t),s=a.get("category"),d=a.get("weight"),c=(a.get("search")||"").toLowerCase().trim(),u=e.divisions.filter(e=>{if("men"===s&&!e.id.startsWith("mens-"))return!1;if("women"===s&&!e.id.startsWith("womens-"))return!1;if("all"!==d){const t=parseInt(e.weight,10);if(Number.isFinite(t)){if("light"===d&&t>145)return!1;if("mid"===d&&(t<146||t>185))return!1;if("heavy"===d&&t<186)return!1}}if(c){const t=e.name.toLowerCase().includes(c),n=e.fighters.some(e=>e.name.toLowerCase().includes(c));if(!t&&!n)return!1}return!0});if(n.innerHTML="",0===u.length)return r.hidden=!1,void(o.textContent="No divisions displayed");r.hidden=!0;const l=document.createDocumentFragment();u.forEach(e=>{const t=document.createElement("article");t.className="division-card",t.setAttribute("role","listitem");const n=`assets/img/divisions/${e.id}.webp`;t.innerHTML=`\n        <figure class="division-card__banner">\n          <img src="${n}" alt="${e.name} banner artwork" loading="lazy" />\n        </figure>\n        <header>\n          <h3>${e.name}</h3>\n          <span>${e.weight}</span>\n        </header>\n        <div class="division-fighters">\n          ${e.fighters.map(e=>`\n                <article class="fighter-mini">\n                  <img src="${e.img}" alt="${e.name} portrait" loading="lazy" />\n                  <div>\n                    <h4>${e.name}</h4>\n                    <p class="meta">${i(e.rank)} 路 Record ${e.record}</p>\n                    <a class="button button-outline" href="fighters/${e.slug}.html">\n                      Visit profile\n                    </a>\n                  </div>\n                </article>\n              `).join("")}\n        </div>\n      `,l.append(t)}),n.append(l);const m=u.reduce((e,t)=>e+t.fighters.length,0);o.textContent=`${u.length} divisions 路 ${m} fighters displayed`};t.addEventListener("input",()=>s()),t.addEventListener("submit",e=>e.preventDefault()),a?.addEventListener("click",()=>{t.reset(),s()}),s()}()});